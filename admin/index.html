<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Dashboard </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #f1f5f9; }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1B6E3F;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status-wait { border-left: 5px solid #ef4444; }
        .status-process { border-left: 5px solid #f59e0b; }
        .status-done { border-left: 5px solid #10b981; }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 24px;
            border-radius: 24px;
            width: 95%;
            max-width: 650px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-height: 85vh;
            display: flex;
            flex-direction: column;
        }
        .editable-input:focus {
            background-color: #fff;
            border-color: #1B6E3F;
            box-shadow: 0 0 0 2px rgba(27, 110, 63, 0.1);
        }
        .btn-close-modal {
            color: #ef4444;
            font-size: 2.25rem; /* 36px */
            line-height: 1;
            padding: 0.5rem;
            transition: all 0.2s;
            border-radius: 0.75rem;
            font-weight: 300;
        }
        .btn-close-modal:hover {
            background-color: #fef2f2;
            transform: scale(1.1);
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß -->
    <nav class="bg-[#1B6E3F] text-white p-4 sticky top-0 shadow-lg z-50">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-2">
                <div class="bg-white p-1 rounded-lg shadow-inner">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-[#1B6E3F]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                </div>
                <span class="text-xl font-bold tracking-wide">Dashboard Admin</span>
            </div>
            
            <div class="flex items-center gap-2">
                <button onclick="fetchMenus()" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-xl transition flex items-center gap-2 text-sm border border-white/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π
                </button>
                <button onclick="toggleModal('hours-modal')" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-xl transition flex items-center gap-2 text-sm border border-white/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î
                </button>
                <button onclick="fetchOrders()" class="bg-white/20 hover:bg-white/30 p-2 rounded-full transition ml-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                </button>
            </div>
        </div>
    </nav>

    <!-- Modal ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ) -->
    <div id="menu-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="bg-green-100 p-2 rounded-lg text-[#1B6E3F]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
                </div>
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏Å‡∏ö‡∏≤‡∏ó‡∏™‡∏µ‡πÅ‡∏î‡∏á ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà -->
                <button onclick="toggleModal('menu-modal')" class="btn-close-modal">&times;</button>
            </div>
            
            <div id="menu-loading" class="flex flex-col items-center py-10 hidden">
                <div class="loader mb-2"></div>
                <span class="text-gray-400 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏ô‡∏π...</span>
            </div>

            <div class="overflow-y-auto flex-1 pr-1 custom-scrollbar">
                <table class="w-full">
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
                            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase w-32">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-500 uppercase w-32">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            <th class="px-4 py-3 text-center text-xs font-semibold text-gray-500 uppercase w-16">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
                        </tr>
                    </thead>
                    <tbody id="menu-list-content" class="divide-y divide-gray-100">
                        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å JS -->
                    </tbody>
                </table>
            </div>
            
            <div class="mt-4 pt-4 border-t border-gray-100 text-center">
                <p class="text-[10px] text-gray-400 font-medium">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheet ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
            </div>
        </div>
    </div>

    <!-- Modal ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î -->
    <div id="hours-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <div class="bg-orange-100 p-2 rounded-lg text-orange-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h3>
                </div>
                <button onclick="toggleModal('hours-modal')" class="btn-close-modal">&times;</button>
            </div>

            <div class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-gray-500 ml-1 italic">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î</label>
                        <input type="time" id="open-time" value="08:00" class="w-full px-4 py-3 rounded-2xl border border-gray-200 focus:ring-2 focus:ring-orange-400 outline-none text-lg font-bold text-gray-700 shadow-sm bg-gray-50">
                    </div>
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-gray-500 ml-1 italic">‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î</label>
                        <input type="time" id="close-time" value="19:00" class="w-full px-4 py-3 rounded-2xl border border-gray-200 focus:ring-2 focus:ring-orange-400 outline-none text-lg font-bold text-gray-700 shadow-sm bg-gray-50">
                    </div>
                </div>

                <button onclick="updateBusinessHours()" class="w-full bg-[#1B6E3F] hover:bg-[#155a33] text-white font-bold py-4 rounded-2xl shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto p-4 md:p-6">
        <div class="mb-6 flex flex-wrap items-center gap-3">
            <label for="search-date" class="text-gray-700 font-semibold text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
            <input type="date" id="search-date" onchange="fetchOrders()" class="px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[#1B6E3F] focus:border-[#1B6E3F] outline-none text-gray-600 shadow-sm">
        </div>

        <div id="loading-overlay" class="fixed inset-0 bg-white/60 z-[100] hidden flex items-center justify-center backdrop-blur-sm">
            <div class="flex flex-col items-center bg-white p-8 rounded-3xl shadow-2xl">
                <div class="loader mb-4"></div>
                <p class="text-gray-600 font-semibold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</p>
            </div>
        </div>

        <!-- Desktop Table -->
        <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden mb-6 hidden md:block">
            <table class="w-full text-left">
                <thead class="bg-gray-50 border-b border-gray-100 text-gray-500 uppercase text-xs">
                    <tr>
                        <th class="px-6 py-4 font-semibold">‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th>
                        <th class="px-6 py-4 font-semibold">ID / ‡πÇ‡∏ï‡πä‡∏∞</th>
                        <th class="px-6 py-4 font-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</th>
                        <th class="px-6 py-4 font-semibold text-center">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü</th>
                        <th class="px-6 py-4 font-semibold text-right">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                        <th class="px-6 py-4 font-semibold text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="px-6 py-4 font-semibold text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="order-tbody" class="divide-y divide-gray-50 bg-white text-gray-700"></tbody>
            </table>
        </div>

        <!-- Mobile Cards -->
        <div id="order-cards" class="md:hidden space-y-4"></div>

        <div id="empty-state" class="hidden py-24 text-center bg-white rounded-3xl shadow-sm border border-dashed border-gray-200">
            <div class="text-7xl mb-6 grayscale opacity-50">üì¶</div>
            <p class="text-gray-400 text-lg font-medium">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
        </div>
    </main>

    <script>
        let scriptUrl = "";

        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = (modal.style.display === "block") ? "none" : "block";
        }

        window.onclick = function(event) {
            if (event.target.className === 'modal') event.target.style.display = "none";
        }

        function setDefaultDate() {
            const today = new Date();
            const offset = today.getTimezoneOffset() * 60000;
            const localISOTime = (new Date(today.getTime() - offset)).toISOString().slice(0, 10);
            document.getElementById('search-date').value = localISOTime;
        }

        async function init() {
            setDefaultDate();
            try {
                const response = await fetch('../data.json'); 
                const config = await response.json();
                if (config.googlescript && config.googlescript.length > 0) {
                    scriptUrl = config.googlescript[0].url;
                    fetchOrders();
                }
            } catch (e) {
                console.error("Init Error:", e);
            }
        }

        async function fetchMenus() {
            if (!scriptUrl) return;
            const content = document.getElementById('menu-list-content');
            const loading = document.getElementById('menu-loading');
            
            toggleModal('menu-modal');
            content.innerHTML = "";
            loading.classList.remove('hidden');

            try {
                const res = await fetch(`${scriptUrl}?action=getMenus`);
                const data = await res.json();
                loading.classList.add('hidden');

                if (!data || data.length <= 1) {
                    content.innerHTML = '<tr><td colspan="4" class="p-6 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                    return;
                }

                data.slice(1).forEach((row, index) => {
                    const [name, price, status, type] = row;
                    if(!name) return;

                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-gray-50 transition";
                    tr.innerHTML = `
                        <td class="px-4 py-3 text-sm font-medium text-gray-700">
                            <div class="font-bold">${name}</div>
                            <div class="text-[10px] text-gray-400 font-normal">${type || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}</div>
                        </td>
                        <td class="px-4 py-3">
                            <input type="number" value="${price}" id="price-${index}" 
                                class="editable-input w-full px-2 py-1.5 border border-gray-200 rounded-lg text-sm font-bold text-[#1B6E3F] outline-none">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <select id="status-${index}" 
                                class="editable-input w-full px-2 py-1.5 border border-gray-200 rounded-lg text-xs font-bold outline-none">
                                <option value="‡∏û‡∏£‡πâ‡∏≠‡∏°" ${status === '‡∏û‡∏£‡πâ‡∏≠‡∏°' ? 'selected' : ''}>üü¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°</option>
                                <option value="‡∏´‡∏°‡∏î" ${status === '‡∏´‡∏°‡∏î' ? 'selected' : ''}>üî¥ ‡∏´‡∏°‡∏î</option>
                            </select>
                        </td>
                        <td class="px-4 py-3 text-center">
                            <button onclick="updateMenuData('${name}', ${index})" 
                                class="bg-green-500 hover:bg-green-600 text-white p-2 rounded-lg shadow-sm transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                </svg>
                            </button>
                        </td>
                    `;
                    content.appendChild(tr);
                });
            } catch (e) {
                loading.classList.add('hidden');
                console.error("Menu fetch error", e);
            }
        }

        async function updateMenuData(menuName, idx) {
            const price = document.getElementById(`price-${idx}`).value;
            const status = document.getElementById(`status-${idx}`).value;
            const overlay = document.getElementById('loading-overlay');

            overlay.classList.remove('hidden');
            try {
                const res = await fetch(`${scriptUrl}?action=updateMenu`, {
                    method: 'POST',
                    body: JSON.stringify({ name: menuName, price: price, status: status })
                });
                const result = await res.json();
                if (result.status === 'success') {
                    const btn = document.querySelectorAll('#menu-list-content button')[idx];
                    btn.classList.replace('bg-green-500', 'bg-blue-500');
                    setTimeout(() => btn.classList.replace('bg-blue-500', 'bg-green-500'), 1000);
                } else {
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + result.message);
                }
            } catch (e) {
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ");
            } finally {
                overlay.classList.add('hidden');
            }
        }

        function formatFoodItems(itemsString) {
            if (!itemsString) return "-";
            return itemsString.split(',').map(item => `<div class="py-1 flex items-start gap-2"><span class="text-green-500 mt-1">‚óè</span> <span>${item.trim()}</span></div>`).join('');
        }

        async function fetchOrders() {
            const tbody = document.getElementById('order-tbody');
            const cardContainer = document.getElementById('order-cards');
            const empty = document.getElementById('empty-state');
            const selectedDate = document.getElementById('search-date').value;
            
            if (!scriptUrl) return;

            try {
                const res = await fetch(`${scriptUrl}?action=getOrders`);
                const data = await res.json();

                if (!data || data.length <= 1) {
                    tbody.innerHTML = ""; cardContainer.innerHTML = ""; empty.classList.remove('hidden'); return;
                }

                const filteredData = data.slice(1).filter(row => {
                    const orderDate = new Date(row[0]);
                    const dStr = `${orderDate.getFullYear()}-${String(orderDate.getMonth() + 1).padStart(2, '0')}-${String(orderDate.getDate()).padStart(2, '0')}`;
                    return dStr === selectedDate;
                });

                if (filteredData.length === 0) {
                    tbody.innerHTML = ""; cardContainer.innerHTML = ""; empty.classList.remove('hidden'); return;
                }

                empty.classList.add('hidden');
                tbody.innerHTML = ""; cardContainer.innerHTML = "";

                filteredData.reverse().forEach(row => {
                    const [timestamp, orderId, items, total, table, status, serveTime] = row;
                    const fTime = timestamp ? new Date(timestamp).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' }) : '-';
                    const statusClass = status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥" ? "status-process" : (status === "‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß" ? "status-done" : "status-wait");

                    const tr = document.createElement('tr');
                    tr.className = `hover:bg-gray-50/50 transition border-l-4 ${statusClass}`;
                    tr.innerHTML = `
                        <td class="px-6 py-5 text-xs text-gray-400 font-medium">${fTime} ‡∏ô.</td>
                        <td class="px-6 py-5">
                            <div class="font-bold text-gray-800 tracking-tight">#${orderId}</div>
                            <div class="text-[11px] font-bold text-[#1B6E3F] bg-green-50 px-2 py-0.5 rounded-full inline-block">‡πÇ‡∏ï‡πä‡∏∞ ${table}</div>
                        </td>
                        <td class="px-6 py-5 text-sm">${formatFoodItems(items)}</td>
                        <td class="px-6 py-5 text-center text-sm font-bold text-orange-500">${serveTime || '-'}</td>
                        <td class="px-6 py-5 text-right font-black text-gray-900">${Number(total).toLocaleString()} ‡∏ø</td>
                        <td class="px-6 py-5 text-center">
                            <select onchange="updateOrderStatus('${orderId}', this.value)" class="text-xs font-bold rounded-xl px-3 py-2 border border-gray-200 bg-white">
                                <option value="‡∏£‡∏≠" ${status === '‡∏£‡∏≠' ? 'selected' : ''}>‚è≥ ‡∏£‡∏≠</option>
                                <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥" ${status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥' ? 'selected' : ''}>üî• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</option>
                                <option value="‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß" ${status === '‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‚úÖ ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß</option>
                            </select>
                        </td>
                        <td class="px-6 py-5 text-center">
                            <button onclick="deleteOrder('${orderId}')" class="text-gray-300 hover:text-red-500 transition p-2 hover:bg-red-50 rounded-xl">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);

                    const card = document.createElement('div');
                    card.className = `bg-white p-5 rounded-3xl shadow-sm border-l-8 ${statusClass} border border-gray-100`;
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div><div class="text-[10px] text-gray-400 font-bold mb-1">${fTime} ‡∏ô.</div><div class="font-black text-gray-800 text-xl">‡πÇ‡∏ï‡πä‡∏∞ ${table}</div></div>
                            <button onclick="deleteOrder('${orderId}')" class="text-gray-300 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                        </div>
                        <div class="text-sm text-gray-600 mb-4 bg-gray-50 p-4 rounded-2xl">${formatFoodItems(items)}</div>
                        <div class="flex justify-between items-end">
                            <span class="text-xl font-black">${Number(total).toLocaleString()} ‡∏ø</span>
                            <select onchange="updateOrderStatus('${orderId}', this.value)" class="text-sm font-bold rounded-2xl px-4 py-2 border border-gray-200">
                                <option value="‡∏£‡∏≠" ${status === '‡∏£‡∏≠' ? 'selected' : ''}>‡∏£‡∏≠</option>
                                <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥" ${status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥' ? 'selected' : ''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</option>
                                <option value="‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß" ${status === '‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏•‡πâ‡∏ß</option>
                            </select>
                        </div>
                    `;
                    cardContainer.appendChild(card);
                });
            } catch (e) { console.error(e); }
        }

        async function updateOrderStatus(id, st) {
            document.getElementById('loading-overlay').classList.remove('hidden');
            try {
                await fetch(`${scriptUrl}?action=updateStatus`, { method: 'POST', body: JSON.stringify({ orderId: id, status: st }) });
                fetchOrders();
            } catch (e) { alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); }
            finally { document.getElementById('loading-overlay').classList.add('hidden'); }
        }

        async function deleteOrder(id) {
            if (!confirm(`‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${id}?`)) return;
            document.getElementById('loading-overlay').classList.remove('hidden');
            try {
                await fetch(`${scriptUrl}?action=deleteOrder`, { method: 'POST', body: JSON.stringify({ orderId: id }) });
                fetchOrders();
            } catch (e) { alert("‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"); }
            finally { document.getElementById('loading-overlay').classList.add('hidden'); }
        }

        init();
        setInterval(fetchOrders, 60000);
    </script>
</body>
</html>
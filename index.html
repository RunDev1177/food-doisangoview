<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞ - ‡∏î‡∏≠‡∏¢‡∏™‡∏∞‡πÇ‡∏á‡πâ‡∏ß‡∏¥‡∏ß ‡πÇ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏¢‡πå</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #f3f4f6; }
        .primary-bg { background-color: #1B6E3F; }
        .table-card { transition: all 0.2s; cursor: pointer; border: 2px solid transparent; }
        .table-card.selected { border-color: #1B6E3F; background-color: #ecfdf5; transform: scale(1.05); }
    </style>
</head>
<body class="pb-24">
    <!-- ‡∏õ‡∏£‡∏±‡∏ö Header ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏ã‡πâ‡∏≤‡∏¢‡∏°‡∏∑‡∏≠ -->
    <header class="primary-bg text-white p-4 shadow-lg rounded-b-3xl">
        <div class="max-w-4xl mx-auto flex items-center gap-4">
            <img src="img/logo.png" alt="Logo" class="w-14 h-14 object-contain rounded-full bg-white p-1" onerror="this.style.display='none'">
            <div class="text-left">
                <h1 class="text-xl font-bold leading-tight">‡∏î‡∏≠‡∏¢‡∏™‡∏∞‡πÇ‡∏á‡πâ‡∏ß‡∏¥‡∏ß ‡πÇ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏¢‡πå</h1>
                <p class="text-xs opacity-80">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏ô‡∏±‡πà‡∏á</p>
            </div>
        </div>
    </header>

    <main class="p-6 max-w-4xl mx-auto">
        <div id="table-container" class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <div class="col-span-full text-center py-10 text-gray-500 italic">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ï‡πä‡∏∞...</div>
        </div>
    </main>

    <div id="next-bar" class="fixed bottom-0 left-0 right-0 p-4 bg-white shadow-lg hidden">
        <div class="max-w-4xl mx-auto">
            <button onclick="goToMenu()" class="w-full primary-bg text-white py-4 rounded-xl text-lg font-bold flex justify-center items-center gap-2">
                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <span id="selected-table-name"></span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
            </button>
        </div>
    </div>

    <script>
        let selectedTid = null;
        let selectedTname = null;
        let scriptUrl = "";

        async function init() {
            try {
                // ‡∏î‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å data.json
                const configResp = await fetch('data.json');
                const config = await configResp.json();
                scriptUrl = config.googlescript[0].url;
                fetchTables();
            } catch (e) {
                console.error("Config load error", e);
                document.getElementById('table-container').innerHTML = `<div class="col-span-full text-center text-red-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (data.json)</div>`;
            }
        }

        async function fetchTables() {
            const container = document.getElementById('table-container');
            try {
                const response = await fetch(`${scriptUrl}?action=getTables`);
                const data = await response.json();
                
                container.innerHTML = '';
                // data[0] ‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á [‡∏•‡∏≥‡∏î‡∏±‡∏ö, ‡πÇ‡∏ï‡πä‡∏∞]
                for (let i = 1; i < data.length; i++) {
                    const tid = data[i][0];
                    const tname = data[i][1];
                    if(!tname) continue;

                    const card = document.createElement('div');
                    card.className = "table-card bg-white p-8 rounded-2xl shadow-sm flex flex-col items-center justify-center";
                    card.id = `table-${tid}`;
                    card.innerHTML = `
                        <div class="text-4xl mb-3">üçΩÔ∏è</div>
                        <span class="text-gray-700 font-medium text-lg">‡πÇ‡∏ï‡πä‡∏∞ ${tname}</span>
                    `;
                    card.onclick = () => {
                        selectedTid = tid;
                        selectedTname = tname;
                        document.querySelectorAll('.table-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        document.getElementById('selected-table-name').innerText = `‡πÇ‡∏ï‡πä‡∏∞ ${tname}`;
                        document.getElementById('next-bar').classList.remove('hidden');
                    };
                    container.appendChild(card);
                }
            } catch (error) {
                container.innerHTML = `<div class="col-span-full text-center text-red-500">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Script URL</div>`;
            }
        }

        function goToMenu() {
            if (selectedTid) {
                window.location.href = `menus.html?tid=${selectedTid}&tname=${encodeURIComponent(selectedTname)}`;
            }
        }

        init();
    </script>
</body>
</html>